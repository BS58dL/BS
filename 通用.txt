repeat
	task.wait()
until game:IsLoaded()

local library = {}
library.currentTab = nil
library.flags = {}

local services = setmetatable({}, {
	__index = function(t, k)
		return game.GetService(game, k)
	end,
})

local mouse = services.Players.LocalPlayer:GetMouse()

-- 简化主题
local Theme = {
	Primary = Color3.fromRGB(30, 136, 229),
	Background = Color3.fromRGB(18, 18, 18),
	Surface = Color3.fromRGB(30, 30, 30),
	TextPrimary = Color3.fromRGB(255, 255, 255),
}

-- 简化Tween
function Tween(obj, duration, properties)
	local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	local tween = services.TweenService:Create(obj, tweenInfo, properties)
	tween:Play()
	return tween
end

-- 简化涟漪
function CreateRipple(obj)
	spawn(function()
		if not obj.ClipsDescendants then obj.ClipsDescendants = true end
		local ripple = Instance.new("ImageLabel")
		ripple.Parent = obj
		ripple.BackgroundTransparency = 1
		ripple.Image = "rbxassetid://2708891598"
		ripple.ImageTransparency = 0.7
		ripple.ImageColor3 = Theme.Primary
		ripple.Position = UDim2.new(0, mouse.X - obj.AbsolutePosition.X, 0, mouse.Y - obj.AbsolutePosition.Y)
		ripple.Size = UDim2.new(0, 0, 0, 0)
		Tween(ripple, 0.6, {Position = UDim2.new(-5.5, 0, -5.5, 0), Size = UDim2.new(12, 0, 12, 0), ImageTransparency = 1})
		wait(0.6)
		ripple:Destroy()
	end)
end

-- 主UI创建（简化版）
function library.new(library, name)
	-- 清理旧UI
	for _, v in pairs(services.CoreGui:GetChildren() do
		if v.Name == "TestUI" then v:Destroy() end
	end
	
	local ui = Instance.new("ScreenGui")
	ui.Name = "TestUI"
	ui.Parent = services.CoreGui
	ui.ResetOnSpawn = false
	
	if syn and syn.protect_gui then syn.protect_gui(ui) end
	
	-- 主容器
	local Main = Instance.new("Frame")
	Main.Name = "Main"
	Main.Parent = ui
	Main.AnchorPoint = Vector2.new(0.5, 0.5)
	Main.BackgroundColor3 = Theme.Surface
	Main.Position = UDim2.new(0.5, 0, 0.5, 0)
	Main.Size = UDim2.new(0, 600, 0, 400)
	Main.Active = true
	
	local MainCorner = Instance.new("UICorner")
	MainCorner.CornerRadius = UDim.new(0, 12)
	MainCorner.Parent = Main
	
	-- 关闭按钮
	local CloseBtn = Instance.new("TextButton")
	CloseBtn.Name = "CloseBtn"
	CloseBtn.Parent = Main
	CloseBtn.BackgroundColor3 = Color3.fromRGB(231, 76, 60)
	CloseBtn.Position = UDim2.new(1, -40, 0, 10)
	CloseBtn.Size = UDim2.new(0, 30, 0, 30)
	CloseBtn.Font = Enum.Font.GothamBold
	CloseBtn.Text = "×"
	CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	CloseBtn.TextSize = 24
	
	CloseBtn.MouseButton1Click:Connect(function()
		ui:Destroy()
	end)
	
	-- 侧边栏
	local Sidebar = Instance.new("Frame")
	Sidebar.Name = "Sidebar"
	Sidebar.Parent = Main
	Sidebar.BackgroundColor3 = Theme.Surface
	Sidebar.Size = UDim2.new(0, 140, 1, 0)
	
	-- 搜索框
	local SearchBox = Instance.new("TextBox")
	SearchBox.Name = "SearchBox"
	SearchBox.Parent = Sidebar
	SearchBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	SearchBox.Position = UDim2.new(0, 10, 0, 10)
	SearchBox.Size = UDim2.new(1, -20, 0, 35)
	SearchBox.Font = Enum.Font.Gotham
	SearchBox.PlaceholderText = "搜索标签页..."
	SearchBox.Text = ""
	SearchBox.TextColor3 = Theme.TextPrimary
	SearchBox.TextSize = 14
	
	local SearchCorner = Instance.new("UICorner")
	SearchCorner.CornerRadius = UDim.new(0, 8)
	SearchCorner.Parent = SearchBox
	
	-- 标签容器
	local TabContainer = Instance.new("ScrollingFrame")
	TabContainer.Name = "TabContainer"
	TabContainer.Parent = Sidebar
	TabContainer.BackgroundTransparency = 1
	TabContainer.Position = UDim2.new(0, 0, 0, 55)
	TabContainer.Size = UDim2.new(1, 0, 1, -55)
	TabContainer.ScrollBarThickness = 0
	
	local TabListLayout = Instance.new("UIListLayout")
	TabListLayout.Parent = TabContainer
	TabListLayout.Padding = UDim.new(0, 5)
	
	-- 内容区域
	local Content = Instance.new("Frame")
	Content.Name = "Content"
	Content.Parent = Main
	Content.BackgroundTransparency = 1
	Content.Position = UDim2.new(0, 150, 0, 10)
	Content.Size = UDim2.new(1, -160, 1, -20)
	
	-- Tab切换功能
	local function SwitchTab(newTab)
		local oldTab = library.currentTab
		if oldTab and oldTab[1] == newTab[1] then return end
		
		if oldTab then
			oldTab[2].Visible = false
			Tween(oldTab[1], 0.2, {BackgroundTransparency = 0.4})
		end
		
		library.currentTab = newTab
		newTab[2].Visible = true
		Tween(newTab[1], 0.2, {BackgroundTransparency = 0.1})
	end
	
	-- 窗口对象
	local window = {}
	local allTabs = {}
	
	-- 创建标签页
	function window.Tab(window, tabName, iconId)
		iconId = iconId or "4370341699"
		
		-- 标签按钮
		local TabButton = Instance.new("TextButton")
		TabButton.Name = "TabButton"
		TabButton.Parent = TabContainer
		TabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
		TabButton.BackgroundTransparency = library.currentTab == nil and 0.1 or 0.4
		TabButton.BorderSizePixel = 0
		TabButton.Size = UDim2.new(1, -20, 0, 40)
		TabButton.Position = UDim2.new(0, 10, 0, 0)
		TabButton.AutoButtonColor = false
		TabButton.Font = Enum.Font.GothamSemibold
		TabButton.Text = "  " .. tabName
		TabButton.TextColor3 = Theme.TextPrimary
		TabButton.TextSize = 14
		TabButton.TextXAlignment = Enum.TextXAlignment.Left
		
		local TabBtnCorner = Instance.new("UICorner")
		TabBtnCorner.CornerRadius = UDim.new(0, 8)
		TabBtnCorner.Parent = TabButton
		
		-- 标签页内容
		local TabPage = Instance.new("ScrollingFrame")
		TabPage.Name = "TabPage"
		TabPage.Parent = Content
		TabPage.BackgroundTransparency = 1
		TabPage.Size = UDim2.new(1, 0, 1, 0)
		TabPage.ScrollBarThickness = 3
		TabPage.Visible = false
		
		TabButton.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				CreateRipple(TabButton)
				SwitchTab({TabButton, TabPage})
			end
		end)
		
		-- 存储标签数据
		table.insert(allTabs, {
			button = TabButton,
			page = TabPage,
			name = tabName:lower(),
			fullName = tabName
		})
		
		if library.currentTab == nil then
			SwitchTab({TabButton, TabPage})
		end
		
		-- Tab对象
		local tab = {}
		
		-- 创建区域
		function tab.Section(tab, sectionName, defaultOpen)
			defaultOpen = defaultOpen ~= false
			
			local Section = Instance.new("Frame")
			Section.Name = "Section"
			Section.Parent = TabPage
			Section.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
			Section.BackgroundTransparency = 0.2
			Section.BorderSizePixel = 0
			Section.ClipsDescendants = true
			Section.Size = UDim2.new(1, 0, 0, 50)
			
			local SectionCorner = Instance.new("UICorner")
			SectionCorner.CornerRadius = UDim.new(0, 8)
			SectionCorner.Parent = Section
			
			local Header = Instance.new("Frame")
			Header.Name = "Header"
			Header.Parent = Section
			Header.BackgroundTransparency = 1
			Header.Size = UDim2.new(1, 0, 0, 50)
			
			local SectionTitle = Instance.new("TextLabel")
			SectionTitle.Name = "SectionTitle"
			SectionTitle.Parent = Header
			SectionTitle.BackgroundTransparency = 1
			SectionTitle.Position = UDim2.new(0, 15, 0, 0)
			SectionTitle.Size = UDim2.new(1, -50, 1, 0)
			SectionTitle.Font = Enum.Font.GothamBold
			SectionTitle.Text = sectionName
			SectionTitle.TextColor3 = Theme.TextPrimary
			SectionTitle.TextSize = 16
			SectionTitle.TextXAlignment = Enum.TextXAlignment.Left
			
			local Content = Instance.new("Frame")
			Content.Name = "Content"
			Content.Parent = Section
			Content.BackgroundTransparency = 1
			Content.Position = UDim2.new(0, 0, 0, 50)
			Content.Size = UDim2.new(1, 0, 0, 0)
			
			local ContentLayout = Instance.new("UIListLayout")
			ContentLayout.Name = "ContentLayout"
			ContentLayout.Parent = Content
			ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
			ContentLayout.Padding = UDim.new(0, 10)
			
			local isOpen = defaultOpen
			
			local function updateSize()
				if isOpen then
					Section.Size = UDim2.new(1, 0, 0, 50 + ContentLayout.AbsoluteContentSize.Y + 15)
				else
					Section.Size = UDim2.new(1, 0, 0, 50)
				end
			end
			
			Header.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 then
					isOpen = not isOpen
					updateSize()
				end
			end)
			
			ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateSize)
			updateSize()
			
			local section = {}
			
			-- 创建按钮
			function section.Button(section, text, callback)
				callback = callback or function() end
				
				local Button = Instance.new("TextButton")
				Button.Name = "Button"
				Button.Parent = Content
				Button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
				Button.BorderSizePixel = 0
				Button.Size = UDim2.new(1, -20, 0, 45)
				Button.Position = UDim2.new(0, 10, 0, 0)
				Button.AutoButtonColor = false
				Button.Font = Enum.Font.GothamSemibold
				Button.Text = text
				Button.TextColor3 = Theme.TextPrimary
				Button.TextSize = 15
				
				local ButtonCorner = Instance.new("UICorner")
				ButtonCorner.CornerRadius = UDim.new(0, 8)
				ButtonCorner.Parent = Button
				
				Button.MouseButton1Click:Connect(function()
					callback()
				end)
			end
			
			return section
		end
		
		return tab
	end
	
	-- 搜索功能
	SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
		local searchText = SearchBox.Text:lower()
		
		-- 重置所有标签页可见性
		for _, tabData in ipairs(allTabs) do
			tabData.button.Visible = true
		end
		
		if searchText ~= "" then
			for _, tabData in ipairs(allTabs) do
				local isMatch = tabData.name:find(searchText) ~= nil
				tabData.button.Visible = isMatch
			end
		end
		
		TabContainer.CanvasSize = UDim2.new(0, 0, 0, TabListLayout.AbsoluteContentSize.Y + 20)
	end)
	
	return window
end

return library
